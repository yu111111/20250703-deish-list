### **【改訂版】「We Wishlist」要件定義書**

#### 1. 概要
- **プロジェクト名:** We Wishlist
- **コンセプト:**
  パートナーと二人で使うウィッシュリストのWebアプリケーション。
- **デザインコンセプト:**
  モダンで視覚的に魅力的なUI/UXを提供し、直感的で使いやすいデザインを目指す。

#### 2. 機能要件

##### 2.1. ユーザーとリストの管理
- **ユーザー登録（サインアップ）:**
    - 管理者・パートナーともに、メールアドレスとパスワードで自身のSupabaseアカウントを作成できます。
- **ユーザー名更新:**
    - ログイン後、管理者・パートナーともに表示用ユーザー名を更新できます。
- **パートナーの招待:**
    - 管理者はログイン後、一意の「招待コード（リストID）」をパートナーに共有することでリストに招待します。
    - 招待されたパートナーは、ログイン後に招待コードを入力することでリストに参加できます。
    - 参加後、両方のユーザーでリストが共有され、アイテムの追加・更新・削除がリアルタイムに反映されます。
- **ログイン:**
    - 1つのログイン画面を用意します。
    - 管理者・パートナーともに、サインアップ時に登録したメールアドレスとパスワードでログインします。
- **ログアウト:**
    - ログイン中のユーザーは、いつでもログアウトできます。

##### 2.2. 欲しいものリスト機能 (CRUD)
- **登録 (Create):**
    - ログインしているユーザーは、新しい欲しいものをリストに追加できます。
    - 入力項目： 
        - 項目名
        - 価格（任意）
        - カテゴリ：
          - 📱電子機器
          - 🏠️ホーム
          - ✈️旅行
          - その他
- **表示 (Read):**
    - ログイン後、ユーザー名が表示されます。
    - 欲しいものリストはカード形式で表示されます。
    - 表示項目：
        - 項目名（大きく表示）
        - カテゴリ
        - 価格（未設定の場合は非表示、小さく表示）
        - 追加者（ユーザー名のみ表示、右寄せ）
    - カテゴリフィルターを切り替えて、表示されるアイテムが正しくフィルタリングされます。
- **更新 (Update):**
    - 各項目の完了アイコン（チェックマーク/元に戻す）をクリックすることで「完了」状態に切り替えます。
    - 完了した項目は、ページ下側に格納されます。表示/非表示を選択できます。
- **削除 (Delete):**
    - 各項目にある削除アイコン（ゴミ箱）で、その項目をリストから削除できます。
    - 削除時には確認ダイアログが表示されます。
    - 管理者・パートナーどちらでも削除可能です。

#### 3. 画面構成案
- **全体デザイン:** モダンでリッチなデザインを適用。グラデーション背景、丸みを帯びた要素、統一されたフォントとカラーパレットを使用。

1.  **ログイン画面(`index.html`)**
    - アプリ名とサブタイトルを含むヘッダー。
    - メールアドレス入力フォーム、パスワード入力フォーム。
    - ログインボタン、サインアップボタン（共通スタイル適用）。
2.  **メイン画面（リスト一覧 `main.html`）**
    - **ヘッダー:** アプリ名、ログイン中のユーザー名、設定アイコン、ログアウトアイコン。
    - **新規追加フォーム:** 商品名、価格、カテゴリ（プルダウン）の入力フィールドと追加アイコン（横並び、共通スタイル適用）。
    - **カテゴリフィルター:** ボタン形式で「すべて」「電子機器」「ホーム」「旅行」「その他」のカテゴリを切り替え。
    - **欲しいものリスト表示エリア:** カード形式でアイテムを表示。項目名、カテゴリ、価格、追加者、完了/削除アイコンを配置。
        - 各アイテムカードはホバー時にわずかに上に移動するアニメーション効果を持つ。
    - **完了した項目表示エリア:** 完了したアイテムをカード形式で表示。
        - 完了したアイテムは半透明になり、価格に打ち消し線が引かれる。
        - 「完了した項目」セクションには表示/非表示を切り替えるボタンがあり、クリックでリストの表示状態がトグルされる。
3.  **設定画面 (`settings.html`)**
    - アプリ名とサブタイトルを含むヘッダー。
    - **ユーザー設定:** 自身の「表示名」入力・変更フォームと保存ボタン（共通スタイル適用）。
    - **パートナー招待:** 自身の「招待コード」表示エリア、招待コード入力フォーム、リスト参加ボタン（共通スタイル適用）。
    - メイン画面に戻るボタン。

#### 4. データモデル（Supabaseデータベース設計）

この構成は、Supabaseの認証機能(`auth.users`)と連携する以下の2つのテーブルで実現できます。

**1. `profiles` テーブル (ユーザー情報)**
   - Supabaseの認証機能(`auth.users`)と連携し、ユーザー情報を格納します。

| カラム名          | 型            | 説明                                                       |
|-------------------|---------------|------------------------------------------------------------|
| `id`              | `uuid` (PK)   | **ユーザーID。** `auth.users.id`と連携。                   |
| `username`        | `text`        | 表示名。                                                   |
| `list_id`         | `uuid` (FK)   | **参加しているリストのID。** リストは管理者の`id`で識別される。管理者自身も自分の`id`を格納。パートナーは招待元の管理者の`id`を格納。NULL許容。 |
| `created_at`      | `timestamptz` | 作成日時                                                   |

*補足: `profiles`テーブルの`id`と`list_id`が一致するユーザーが、そのリストの管理者となります。*

**2. `items` テーブル (欲しいものリスト)**
   - 欲しいものアイテムの情報を格納します。

| カラム名       | 型            | 説明                                     |
|----------------|---------------|------------------------------------------|
| `id`           | `bigint` (PK) | 自動採番ID (No.として利用)               |
| `list_id`      | `uuid` (FK)   | **どのリストの項目か。** リスト所有者（管理者）の`profiles.id`と連携。 |
| `author_id`    | `uuid` (FK)   | **誰が追加したか。** `profiles.id`と連携。   |
| `item_name`    | `text`        | 項目名                                   |
| `price`        | `integer`     | 金額                                     |
| `category`     | `text`        | カテゴリ                                 |
| `is_completed` | `boolean`     | 完了したかどうか (デフォルト: `false`)   |
| `created_at`   | `timestamptz` | 作成日時                                 |

#### 5. 技術スタック
- **フロントエンド:** HTML, CSS, JavaScript
  - **ファイル構成:** 管理の簡素化のため、CSSファイルとJavaScriptファイルはそれぞれ1つのファイルに統合します。
- **バックエンド/DB:** Supabase
    - **Authentication:** ユーザー認証に利用
    - **Database:** Supabase Postgres Database

#### 6. 開発のポイント
- **招待フローの確立:** 管理者が発行した招待コードを使い、パートナーがリストに参加するフローを確立することが開発の重要なポイントです。Supabaseの行単位セキュリティ(RLS)を適切に設定し、自分の参加しているリストのデータのみ操作できるように制御する必要があります。